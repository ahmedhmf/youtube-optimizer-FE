<div class="layout-content-container flex flex-col w-full flex-1 gap-8">
  <div class="flex flex-wrap justify-between gap-3 px-4">
    <p
      class="text-[#131018] dark:text-white text-3xl sm:text-4xl font-black leading-tight tracking-[-0.033em] min-w-72"
    >
      AI Content Analyzer
    </p>
  </div>

  <!-- Tabs -->
  <div class="flex flex-col gap-6">
    <div class="flex border-b border-gray-200 dark:border-gray-700">
      @for (tab of tabs; track tab.id) {
        <button
          class="flex items-center gap-2 px-6 py-3 border-b-2 font-medium text-sm transition-colors hover:text-primary dark:text-gray-400 dark:hover:text-primary"
          [class.border-primary]="activeTab() === tab.id"
          [class.border-transparent]="activeTab() !== tab.id"
          [class.text-gray-500]="activeTab() !== tab.id"
          [class.text-primary]="activeTab() === tab.id"
          (click)="setActiveTab(tab.id)"
        >
          <span class="material-symbols-outlined text-lg">{{ tab.icon }}</span>
          {{ tab.label }}
        </button>
      }
    </div>

    <!-- Tab Content -->
    <div
      class="rounded-xl p-6 sm:p-8 relative"
      style="background-image: linear-gradient(to bottom right, #c4a6ff, #e8d8ff)"
      [class.opacity-50]="loading()"
      [class.pointer-events-none]="loading()"
    >
      @if (this.error()) {
        <div
          class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative"
          role="alert"
        >
          <span class="block sm:inline">{{ this.error()?.message }}</span>
          <span class="absolute top-0 bottom-0 right-0 px-4 py-3">
            <svg
              class="fill-current h-6 w-6 text-red-500"
              role="button"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 20 20"
            >
              <title>Close</title>
              <path
                d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"
              />
            </svg>
          </span>
        </div>
      }
      <!-- Loading Overlay -->
      @if (loading()) {
        <div
          class="absolute inset-0 bg-white/30 backdrop-blur-sm flex items-center justify-center rounded-xl z-10"
        >
          <div class="flex flex-col items-center gap-3">
            <svg
              class="animate-spin h-8 w-8 text-[#8A2BE2]"
              fill="none"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              />
              <path
                class="opacity-75"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                fill="currentColor"
              />
            </svg>
            <p class="text-[#8A2BE2] font-semibold">{{ analyzeButtonText }}...</p>
          </div>
        </div>
      }

      <div class="flex flex-col gap-4">
        <!-- URL Tab Content -->
        @if (activeTab() === 'url') {
          <div class="flex flex-col sm:flex-row items-stretch gap-4">
            <div class="relative flex w-full flex-1 items-stretch rounded-lg shadow-sm">
              <input
                class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#131018] dark:text-gray-800 focus:outline-0 focus:ring-2 focus:ring-[#8A2BE2] border-none bg-white h-14 placeholder:text-[#6d5e8d] p-4 text-base font-normal leading-normal disabled:cursor-not-allowed disabled:bg-gray-100"
                placeholder="Paste YouTube URL here..."
                [disabled]="loading()"
                [value]="videoUrl()"
                (input)="videoUrl.set($event.target.value)"
              />
            </div>
            <button
              class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-14 px-8 bg-[#8A2BE2] text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#7e26cc] shadow-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-[#8A2BE2]"
              type="button"
              [disabled]="isAnalyzeDisabled"
              (click)="analyzeVideo()"
            >
              <span class="truncate">{{ analyzeButtonText }}</span>
            </button>
          </div>
        }

        <!-- Upload Tab Content -->
        @if (activeTab() === 'upload') {
          <div class="flex flex-col gap-4">
            @if (!selectedFile()) {
              <div
                class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8 text-center bg-white/50 hover:bg-white/70 transition-colors"
              >
                <input
                  accept="video/*"
                  class="hidden"
                  id="video-upload"
                  type="file"
                  [disabled]="loading()"
                  (change)="onFileSelected($event)"
                />
                <label class="cursor-pointer flex flex-col items-center gap-4" for="video-upload">
                  <span class="material-symbols-outlined text-4xl text-gray-400">cloud_upload</span>
                  <div>
                    <p class="text-lg font-semibold text-gray-700 dark:text-gray-300 mb-1">
                      Drop your video here or click to browse
                    </p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                      Supports MP4, AVI, MOV, MKV (max 100MB)
                    </p>
                  </div>
                </label>
              </div>
            } @else {
              <div class="bg-white/70 rounded-lg p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <span class="material-symbols-outlined text-2xl text-green-600">video_file</span>
                  <div>
                    <p class="font-medium text-gray-800">{{ selectedFile()?.name }}</p>
                    <p class="text-sm text-gray-500">
                      {{ (selectedFile()?.size! / (1024 * 1024)).toFixed(2) }} MB
                    </p>
                  </div>
                </div>
                <button
                  class="text-red-500 hover:text-red-700 p-2 disabled:opacity-50"
                  [disabled]="loading()"
                  (click)="removeFile()"
                >
                  <span class="material-symbols-outlined">delete</span>
                </button>
              </div>
              <button
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-14 px-8 bg-[#8A2BE2] text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#7e26cc] shadow-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-[#8A2BE2] self-start"
                [disabled]="isAnalyzeDisabled"
                (click)="analyzeVideo()"
              >
                <span class="truncate">{{ analyzeButtonText }}</span>
              </button>
            }
          </div>
        }

        <!-- Text Tab Content -->
        @if (activeTab() === 'text') {
          <div class="flex flex-col gap-4">
            <div class="relative">
              <textarea
                class="form-textarea w-full min-h-[200px] resize-y rounded-lg text-[#131018] dark:text-gray-800 focus:outline-0 focus:ring-2 focus:ring-[#8A2BE2] border-none bg-white placeholder:text-[#6d5e8d] p-4 text-base font-normal leading-normal disabled:cursor-not-allowed disabled:bg-gray-100"
                placeholder="Paste your text content here (e.g., video transcript, blog post, article...)&#10;&#10;Minimum 50 characters required for analysis."
                [disabled]="loading()"
                [value]="textContent()"
                (input)="onTextAreaInput($event)"
              ></textarea>
              <div class="absolute bottom-2 right-2 text-xs text-gray-500">
                {{ textContent().length }} characters
                @if (textContent().length > 0 && textContent().length < 50) {
                  <span class="text-red-500 ml-1">(minimum 50)</span>
                }
              </div>
            </div>
            <button
              class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-14 px-8 bg-[#8A2BE2] text-white text-base font-bold leading-normal tracking-[0.015em] hover:bg-[#7e26cc] shadow-sm disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-[#8A2BE2] self-start"
              [disabled]="isAnalyzeDisabled"
              (click)="analyzeVideo()"
            >
              <span class="truncate">{{ analyzeButtonText }}</span>
            </button>
          </div>
        }

        <!-- Advanced Settings (shown for all tabs) -->
        <div class="group/settings">
          <button
            class="flex items-center gap-2 text-sm font-medium text-gray-800 hover:text-black"
            [disabled]="loading()"
          >
            <span>Advanced Settings</span>
            <span
              class="material-symbols-outlined transition-transform duration-300 group-focus-within/settings:rotate-180"
              >expand_more</span
            >
          </button>
          <div
            class="overflow-hidden max-h-0 opacity-0 group-focus-within/settings:max-h-[500px] group-focus-within/settings:opacity-100 transition-all duration-500 ease-in-out"
          >
            <div
              class="mt-4 rounded-xl shadow-lg p-6 bg-white/70 dark:bg-background-dark/50 backdrop-blur-sm text-gray-800 dark:text-white"
            >
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-3">
                  <label class="block text-sm font-bold tracking-wide" for="language-dropdown"
                    >Language</label
                  >
                  <div class="flex flex-col gap-2">
                    @for (language of languages; track language) {
                      <label
                        class="flex items-center p-3 rounded-lg border border-transparent bg-white/50 dark:bg-background-dark/30 cursor-pointer has-[:checked]:border-primary has-[:checked]:ring-2 has-[:checked]:ring-primary dark:has-[:checked]:border-primary transition-all"
                        [class.cursor-not-allowed]="loading()"
                        [class.opacity-50]="loading()"
                      >
                        <input
                          class="form-radio text-primary bg-transparent border-gray-400 dark:border-gray-500 focus:ring-offset-0 focus:ring-primary dark:focus:ring-offset-background-dark/50 disabled:cursor-not-allowed"
                          name="language-dropdown"
                          type="radio"
                          [checked]="settings().language === language.value"
                          [disabled]="loading()"
                          [value]="language.value"
                          (change)="onLanguageChange(language.value)"
                        />
                        <span class="ml-3 text-sm font-medium">{{ language.name }}</span>
                      </label>
                    }
                  </div>
                </div>
                <div class="space-y-3">
                  <p class="block text-sm font-bold tracking-wide">AI Model</p>
                  <div class="flex flex-col gap-2">
                    @for (model of aiModels; track model) {
                      <label
                        class="flex items-center p-3 rounded-lg border border-transparent bg-white/50 dark:bg-background-dark/30 cursor-pointer has-[:checked]:border-primary has-[:checked]:ring-2 has-[:checked]:ring-primary dark:has-[:checked]:border-primary transition-all"
                        [class.cursor-not-allowed]="loading()"
                        [class.opacity-50]="loading()"
                      >
                        <input
                          class="form-radio text-primary bg-transparent border-gray-400 dark:border-gray-500 focus:ring-offset-0 focus:ring-primary dark:focus:ring-offset-background-dark/50 disabled:cursor-not-allowed"
                          name="ai-model-dropdown"
                          type="radio"
                          [checked]="settings().aiModel === model.value"
                          [disabled]="loading()"
                          [value]="model.value"
                          (change)="onModelChange(model.value)"
                        />
                        <span class="ml-3 text-sm font-medium">{{ model.name }}</span>
                      </label>
                    }
                  </div>
                </div>
                <div class="space-y-3">
                  <p class="block text-sm font-bold tracking-wide">Tone</p>
                  <div class="flex flex-wrap gap-2">
                    @for (tone of tones; track tone) {
                      <label
                        class="cursor-pointer"
                        [class.cursor-not-allowed]="loading()"
                        [class.opacity-50]="loading()"
                      >
                        <input
                          class="sr-only peer disabled:cursor-not-allowed"
                          name="tone-dropdown"
                          type="radio"
                          [checked]="settings().tone === tone.value"
                          [disabled]="loading()"
                          [value]="tone.value"
                          (change)="onToneChange(tone.value)"
                        />
                        <span
                          class="px-3 py-1.5 text-sm font-medium rounded-full bg-gray-200 dark:bg-gray-700 peer-checked:bg-primary peer-checked:text-black transition-colors peer-disabled:cursor-not-allowed"
                        >
                          {{ tone.name }}
                        </span>
                      </label>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Section (same as before) -->
  @if (result) {
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 pt-6">
      <div class="lg:col-span-2 flex flex-col gap-6">
        <div class="bg-white dark:bg-background-dark/80 rounded-xl shadow-sm overflow-hidden">
          @if (result.thumbnail_url) {
            <div
              class="bg-center bg-no-repeat aspect-video bg-cover"
              style="background-image: url(&quot;{{ result.thumbnail_url }}&quot;);"
            ></div>
          }
          <div class="p-6">
            <h3 class="text-xl font-bold text-[#131018] dark:text-white">
              {{ result.video_title }}
            </h3>
          </div>
        </div>
        <div class="bg-white dark:bg-background-dark/80 rounded-xl shadow-sm p-6">
          <div class="flex items-center gap-3 mb-4">
            <span class="material-symbols-outlined text-primary">summarize</span>
            <h3 class="text-lg font-bold text-[#131018] dark:text-white">AI Description</h3>
          </div>
          <p class="text-gray-600 dark:text-gray-400 leading-relaxed">
            {{ result.ai_description }}
          </p>
        </div>
      </div>
      <div class="flex flex-col gap-6">
        <div class="bg-white dark:bg-background-dark/80 rounded-xl shadow-sm p-6">
          <div class="flex items-center gap-3 mb-3">
            <span class="material-symbols-outlined text-primary">sentiment_very_satisfied</span>
            <h4 class="text-md font-bold text-[#131018] dark:text-white">AI-Titles</h4>
          </div>
          <div class="flex flex-col items-baseline gap-2">
            @for (title of result.ai_titles; track title) {
              <p class="text-sm font-black text-green-500">{{ title }}</p>
            }
          </div>
        </div>
        <div class="bg-white dark:bg-background-dark/80 rounded-xl shadow-sm p-6">
          <div class="flex items-center gap-3 mb-4">
            <span class="material-symbols-outlined text-primary">sell</span>
            <h4 class="text-md font-bold text-[#131018] dark:text-white">AI-Tags</h4>
          </div>
          <div class="flex flex-wrap gap-2">
            @for (tag of result.ai_tags; track tag) {
              <span
                class="bg-primary/20 text-primary-darker dark:text-primary-lighter rounded-full px-3 py-1 text-sm font-medium"
                >{{ tag }}</span
              >
            }
          </div>
        </div>
        @if (result.ai_thumbnail_prompts) {
          <div class="bg-white dark:bg-background-dark/80 rounded-xl shadow-sm p-6">
            <div class="flex items-center gap-3 mb-3">
              <span class="material-symbols-outlined text-primary">insights</span>
              <h4 class="text-md font-bold text-[#131018] dark:text-white">AI-Thumbnail Prompt</h4>
            </div>
            <p class="text-sm text-gray-500 dark:text-gray-400">
              {{ result.ai_thumbnail_prompts }}
            </p>
          </div>
        }
      </div>
    </div>
  }
</div>
